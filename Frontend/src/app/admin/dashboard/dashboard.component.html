<div class="page-header">
  <h4>Tableau de bord</h4>
  <nav aria-label="breadcrumb">
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><a href="#">Admin</a></li>
      <li class="breadcrumb-item active" aria-current="page">Tableau de bord</li>
    </ol>
  </nav>
</div>

<!-- Stats Cards -->
<div class="row">
  <div class="col-md-6 col-lg-3">
    <div class="stats-card primary">
      <div class="icon">
        <i class="fas fa-book"></i>
      </div>
      <div class="number">{{numberCoursesActive}}</div>
      <div class="title">Cours actifs</div>
    </div>
  </div>

  <div class="col-md-6 col-lg-3">
    <div class="stats-card success">
      <div class="icon">
        <i class="fas fa-users"></i>
      </div>
      <div class="number">{{numberOfUsers}}</div>
      <div class="title">Utilisateurs</div>
    </div>
  </div>

  <div class="col-md-6 col-lg-3">
    <div class="stats-card warning">
      <div class="icon">
        <i class="fas fa-calendar-check"></i>
      </div>
      <div class="number">{{numberOfHackathons}}</div>
      <div class="title">Hackathons en cours</div>
    </div>
  </div>

  <div class="col-md-6 col-lg-3">
    <div class="stats-card danger">
      <div class="icon">
        <i class="fas fa-exclamation-circle"></i>
      </div>
      <div class="number">{{numberOfReclamations}}</div>
      <div class="title">Réclamations</div>
    </div>
  </div>
</div>

<!-- Recent Courses -->
<div class="row">
  <div class="col-lg-8">
    <div class="card">
      <div class="card-header">
        <h5>Derniers cours ajoutés</h5>
        <a href="#" class="btn btn-sm btn-primary">Voir tous</a>
      </div>
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-hover">
            <thead>
            <tr>
              <th>Titre</th>
              <th>Instructeur</th>
              <th>Prix</th>
              <th>Statut</th>
              <th>Actions</th>
            </tr>
            </thead>
            <tbody>
            <tr *ngFor="let course of courses">
              <td>{{course.title}}</td>
              <td>{{course.formateur.firstname +" "+course.formateur.lastname}}</td>
              <td>{{ course.prix | currency:'TND':'symbol':'1.0-0' }}</td>
              <td><span class="badge" [ngClass]="{ 'badge-success': course.status, 'badge-danger': !course.status }">
                  {{ course.status ? 'Actif' : 'Brouillon' }}
                </span>
              </td>
              <td>
                <button class="btn btn-sm btn-outline-primary" [routerLink]="'/admin/updateCourse/'+course._id" ><i class="fas fa-edit"></i></button>
                <button class="btn btn-sm btn-outline-danger" (click)="deleteCourse(course._id)" ><i class="fas fa-trash"></i></button>
              </td>
            </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <div class="col-lg-4">
    <div class="card">
      <div class="card-header">
        <h5>Dernières réclamations</h5>
        <a style="cursor: pointer" routerLink="/admin/reclamations" class="btn btn-sm btn-primary">Voir tous</a>
      </div>
      <div class="card-body">
        <div class="mb-3" *ngFor="let reclamation of reclamations">
          <div class="d-flex justify-content-between mb-1">
            <strong>{{reclamation.sujet | truncate:30}}</strong>
            <small class="text-muted">{{getRelativeTime(reclamation.createdAt)}}</small>
          </div>
          <p class="text-muted small mb-2">{{reclamation.description | truncate:100}}</p>
          <div class="d-flex justify-content-end">
            <button class="btn btn-sm btn-outline-warning"
                    *ngIf="!reclamation.seen" [routerLink]="'/admin/reclamations/'+reclamation._id" >En attente</button>
            <button class="btn btn-sm btn-outline-primary"
                    style="cursor: default" *ngIf="reclamation.seen"  >Traiter</button>
          </div>
        </div>


      </div>
    </div>
  </div>
</div>

<!-- Upcoming Hackathons -->
<div class="row">
  <div class="col-12">
    <div class="card">
      <div class="card-header">
        <h5>Prochains Hackathons</h5>
        <a style="cursor: pointer" routerLink="/admin/hackathons" class="btn btn-sm btn-primary" >Voir tous</a>
      </div>
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-hover">
            <thead>
            <tr>
              <th>Nom</th>
              <th>Date</th>
              <th>Participants</th>
              <th>Prix</th>
              <th>Statut</th>
              <th>Actions</th>
            </tr>
            </thead>
            <tbody>
            <tr *ngFor="let hack of hackathons">
              <td>{{hack.title}}</td>
              <td>{{ formatDateRange(hack.startDate, hack.endDate) }}</td>
              <td>{{hack.participants.length}}</td>
              <td>{{hack.fee}}</td>
              <td>
                <span class="status-badge" [class]="getStatusClass(hack.status)">
                  {{ getStatusText(hack.status) }}
                </span>
              </td>
              <td>
                <div class="table-actions">
                  <button class="action-btn view-btn" title="Voir" [routerLink]="['/hackathons/'+ hack._id]">
                    <i class="fas fa-eye"></i>
                  </button>
                  <button class="action-btn edit-btn" title="Modifier" [routerLink]="['/admin/updatehackathon/'+ hack._id]">
                    <i class="fas fa-edit"></i>
                  </button>
                  <button class="action-btn delete-btn" title="Supprimer" (click)="deleteHackathon(hack._id)" >
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </td>
            </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
