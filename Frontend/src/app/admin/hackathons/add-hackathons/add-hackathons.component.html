<main class="admin-main">
  <div class="container">
    <div class="page-header">
      <h1 class="page-title">Créer un nouveau hackathon</h1>
      <a (click)="goBackOrFallback()" class="btn btn-outline">
        <i class="fas fa-arrow-left"></i>
        Retour
      </a>
    </div>

    <div class="form-card">
      <div class="form-header">
        <h2 class="form-title">Informations du hackathon</h2>
        <p class="form-subtitle">Renseignez les détails de base du hackathon</p>
      </div>

      <form id="hackathon-form" #addhackathonForm="ngForm" (ngSubmit)="onSubmit(addhackathonForm)">
        <div class="form-grid">
          <div class="form-group">
            <label for="title" class="form-label">Titre du hackathon <span>*</span></label>
            <input type="text" id="title" class="form-control" name="title" [(ngModel)]="title" required placeholder="Ex: Hackathon IA 2023">
          </div>

          <div class="form-group">
            <label for="theme" class="form-label">Thème principal <span>*</span></label>
            <select id="theme" class="form-control" name="categoryid" [(ngModel)]="categoryid" (click)="loadCourses()"  required>
              <option value="">Sélectionnez un theme </option>
              <option  *ngFor="let category of categories" [value]="category._id" >{{category.name}}</option>
            </select>
          </div>

          <div class="form-group">
            <label for="start-date" class="form-label">Date de début <span>*</span></label>
            <input type="datetime-local" id="start-date" class="form-control" name="startDate" [(ngModel)]="startDate" required>
          </div>

          <div class="form-group">
            <label for="end-date" class="form-label">Date de fin <span>*</span></label>
            <input type="datetime-local" id="end-date" class="form-control" name="endDate" [(ngModel)]="endDate" required>
          </div>

          <div class="form-group">
            <label for="location" class="form-label">Lieu <span>*</span></label>
            <input type="text" id="location" class="form-control" name="location" [(ngModel)]="location" required placeholder="Ex: En ligne ou Tunis, Tunisie">
          </div>

          <div class="form-group">
            <label for="max-participants" class="form-label">Nombre maximum de participants</label>
            <input type="number" id="max-participants" class="form-control" [(ngModel)]="maxParticipants" name="maxParticipants" min="1" placeholder="Ex: 100">
          </div>

          <div class="form-group full-width">
            <label for="short-description" class="form-label">Description courte <span>*</span></label>
            <textarea id="short-description" class="form-control" name="shortDescription" [(ngModel)]="shortDescription" required placeholder="Une brève description qui apparaîtra sur la page d'accueil"></textarea>
          </div>

          <div class="form-group full-width">
            <label for="description" class="form-label">Description détaillée <span>*</span></label>
            <textarea id="description" class="form-control" name="description" [(ngModel)]="description" required placeholder="Description complète du hackathon avec les objectifs, les règles, etc."></textarea>
          </div>
          <div class="form-group full-width">
            <label for="objectifs" class="form-label">Objectifs du hackathon</label>
            <div class="skill-input-container">
              <input type="text" id="objectifs" class="form-control skill-input" placeholder="Objectifs du hackathon." name="objectif"  [(ngModel)]="objectif">
              <button type="button" class="add-skill-btn" (click)="addobjectif()">Ajouter</button>
            </div>
            <div class="objectifs-container" id="skills-tags" >
              <div class="skill-tag" *ngFor="let objectif of objectifs" (click)="removeobjectif(objectif)">
                <li>{{objectif}}</li> <i class="fas fa-times-circle "></i>
              </div>
            </div>
          </div>

          <div class="form-group full-width">
            <label for="rules" class="form-label">Règles et conditions</label>
            <div class="skill-input-container">
              <input type="text" id="rules" class="form-control skill-input" placeholder="Règles et conditions." name="rule"  [(ngModel)]="rule">
              <button type="button" class="add-skill-btn" (click)="addrule()">Ajouter</button>
            </div>
            <div class="objectifs-container" id="skills-tags" >
              <div class="skill-tag" *ngFor="let rule of rules" (click)="removerule(rule)">
                <li>{{rule}}</li> <i class="fas fa-times-circle "></i>
              </div>
            </div>
          </div>

          <div class="form-group full-width">
            <label for="skills" class="form-label">Compétences</label>
            <div class="skill-input-container">
              <input type="text" id="skills" class="form-control skill-input" placeholder="Ajouter une compétence" name="skill"  [(ngModel)]="skill">
              <button type="button" class="add-skill-btn" (click)="addSkill()">Ajouter</button>
            </div>
            <div class="skills-container" id="skills-tags" >
              <div class="skill-tag" *ngFor="let skill of competences" (click)="removeSkill(skill)">
                <span>#{{skill}}</span> <i class="fas fa-times-circle "></i>
              </div>
            </div>
          </div>

          <div class="form-group full-width">
            <label class="form-label">Image de couverture <span>*</span></label>
            <div class="file-upload">
              <div class="file-upload-btn"  *ngIf="!imagePreview; else previewBlock" class="file-upload-btn" (click)="fileInput.click()" >
                <div class="file-upload-text">
                  <i class="fas fa-cloud-upload-alt"></i>
                  <span>Cliquez pour télécharger</span>
                  ou glissez-déposez une image
                  <small>(JPEG, PNG - 16:9 recommandé)</small>
                </div>
                <input type="file" class="file-upload-input" accept="image/*" #fileInput type="file" id="thumbnail" (change)="onFileSelected($event)" required>
              </div>
            </div>
            <ng-template #previewBlock>
              <div class="file-preview">
                <img [src]="imagePreview" class="thumbnail-preview" id="file-preview-img" alt="Preview">
                <div class="file-info">
                  <div class="file-name" id="file-name">{{fileName}}</div>
                  <div class="file-size" id="file-size">{{fileSize}}</div>
                </div>
                <i class="fas fa-times file-remove" (click)="removeFile()"></i>
              </div>

            </ng-template>
          </div>

          <div class="form-group full-width" *ngIf="courses.length>0">
            <label class="form-label">Cours associés <span>*</span></label>
            <p class="form-subtitle">Sélectionnez les cours qui seront utiles pour participer à ce hackathon</p>

            <div class="courses-selection">
              <div class="course-checkbox" *ngFor="let course of courses; let i = index">
                <input type="checkbox"
                       id="course-{{i}}"
                       name="coursesSelected"
                       [ngModel]="isSelected(course._id)"
                       (ngModelChange)="toggleCourseSelection(course._id, $event)"
                       [value]="course._id">
                <div class="course-info">
                  <div class="course-title">{{course.title}}</div>
                  <div class="course-details">
                    <span>{{course.niveau}}</span>
                    <span>{{course.duree}} heures</span>
                    <span>{{course.prix}}Dt</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="form-group full-width" *ngIf="courses.length===0 && categoryid!=='' ">
            <label class="form-label">Cours associés <span>*</span></label>

            <div class="courses-selection">
              <div class="no-courses-message">
                <i class="fas fa-book-open"></i>
                <h3>Aucun cours disponible</h3>
                <p>Il n'y a actuellement aucun cours dans le catalogue. Veuillez d'abord créer des cours dans la section "Cours".</p>
                <a href="/admin/addCourse" class="btn-course btn-outline-course">
                  <i class="fas fa-plus-circle"></i>
                  Créer un nouveau cours
                </a>
              </div>
            </div>
          </div>

          <!-- État 2: Sélectionner un thème d'abord -->
          <div class="form-group full-width" *ngIf="categoryid===''">
            <label class="form-label">Cours associés <span>*</span></label>

            <div class="courses-selection">
              <div class="theme-alert-message">
                <i class="fas fa-exclamation-triangle"></i>
                <h3>Sélectionnez d'abord un thème</h3>
                <p>Veuillez d'abord choisir un thème pour le hackathon afin de voir les cours correspondants.</p>
              </div>
            </div>
          </div>

          <div class="form-group">
            <label for="prizes" class="form-label">Prix à gagner</label>
            <input type="text" id="prizes" class="form-control" name="prizes" required [(ngModel)]="Prizes" placeholder="Ex: 5000Dt, Formation gratuite, etc.">
          </div>
          <div class="form-group">
            <label for="fee" class="form-label">Frais de participation</label>
            <input
              type="number"
              id="fee"
              class="form-control"
              name="fee"
              [(ngModel)]="fee"
              required
              placeholder="Ex. : 5000 DT">
          </div>

        </div>

        <div class="form-group full-width">
          <div class="error-container" style="display: none;">
            <div class="error-message">
              <i class="fas fa-exclamation-circle"></i>
              <span class="error-text"></span>
            </div>
          </div>
        </div>

        <div class="form-actions">
          <button type="button" class="btn btn-outline">
            <i class="fas fa-times"></i>
            Annuler
          </button>
          <button type="submit" class="btn btn-primary" [disabled]="addhackathonForm.invalid">
            <i class="fas fa-calendar-plus"></i>
            Créer le hackathon
          </button>
        </div>
      </form>
    </div>
  </div>
</main>
