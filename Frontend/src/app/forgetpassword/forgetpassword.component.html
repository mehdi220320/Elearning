<div class="container">
  <div class="forgot-password-card">
    <div class="card-header">

      <h3>Réinitialisation du mot de passe</h3>
      <p *ngIf="showForm">Entrez votre email pour recevoir un code de vérification</p>
      <p *ngIf="showCodeForm">Saisissez le code reçu et votre nouveau mot de passe</p>
      <p *ngIf="showSuccess" class="success-text">Réinitialisation réussie !</p>
    </div>

    <div class="card-body">
      <!-- Email Form -->
      <div class="form-container" *ngIf="showForm">
        <form [formGroup]="resetForm" (ngSubmit)="onSubmitEmail()">
          <div class="form-group">
            <label for="email">Adresse email</label>
            <div class="input-container">
              <i class="fas fa-envelope input-icon"></i>
              <input
                type="email"
                id="email"
                formControlName="email"
                placeholder="votre@email.com"
                [ngClass]="{ 'is-invalid': email?.invalid && (email?.dirty || email?.touched) }">
            </div>
            <div *ngIf="email?.invalid && (email?.dirty || email?.touched)" class="error-message">
              <small *ngIf="email?.errors?.['required']">L'email est requis</small>
              <small *ngIf="email?.errors?.['email']">Veuillez entrer un email valide</small>
            </div>
          </div>

          <div *ngIf="errorMessage" class="alert alert-danger">
            {{ errorMessage }}
          </div>

          <button type="submit" class="btn btn-primary" [disabled]="isLoading">
            <span *ngIf="!isLoading">
              <i class="fas fa-paper-plane me-2"></i> Envoyer le code
            </span>
            <span *ngIf="isLoading">
              <i class="fas fa-spinner fa-spin me-2"></i> Envoi en cours...
            </span>
          </button>

          <div class="back-to-login">
            <a (click)="backToLogin()"><i class="fas fa-arrow-left me-2"></i>Retour à la connexion</a>
          </div>
        </form>
      </div>

      <!-- Code and New Password Form -->
      <div class="form-container" *ngIf="showCodeForm">
        <form [formGroup]="resetForm" (ngSubmit)="onSubmitReset()">
          <div class="form-group">
            <label for="code">Code de vérification</label>
            <div class="input-container">
              <i class="fas fa-key input-icon"></i>
              <input
                type="text"
                id="code"
                formControlName="code"
                placeholder="123456"
                [ngClass]="{ 'is-invalid': code?.invalid && (code?.dirty || code?.touched) }">
            </div>
            <div *ngIf="code?.invalid && (code?.dirty || code?.touched)" class="error-message">
              <small>Le code de vérification est requis</small>
            </div>
          </div>

          <div class="form-group">
            <label for="newPassword">Nouveau mot de passe</label>
            <div class="input-container">
              <i class="fas fa-lock input-icon"></i>
              <input
                [type]="passwordVisible ? 'text' : 'password'"
                id="newPassword"
                formControlName="newPassword"
                placeholder="••••••••"
                [ngClass]="{ 'is-invalid': newPassword?.invalid && (newPassword?.dirty || newPassword?.touched) }">
              <i
                class="fas password-toggle-icon"
                [ngClass]="passwordVisible ? 'fa-eye-slash' : 'fa-eye'"
                (click)="togglePasswordVisibility('password')"></i>
            </div>
            <div *ngIf="newPassword?.invalid && (newPassword?.dirty || newPassword?.touched)" class="error-message">
              <small *ngIf="newPassword?.errors?.['required']">Le mot de passe est requis</small>
              <small *ngIf="newPassword?.errors?.['minlength']">Minimum 8 caractères</small>
              <small *ngIf="newPassword?.errors?.['pattern']">
                Doit contenir une majuscule, une minuscule, un chiffre et un caractère spécial
              </small>
            </div>
            <div class="password-strength" *ngIf="newPassword?.value">
              <div class="strength-bar" [ngClass]="getPasswordStrengthClass()"></div>

              <small class="strength-text">
                {{ getPasswordStrengthText() }}
              </small>
          </div>
      </div>

      <div class="form-group">
        <label for="confirmPassword">Confirmer le mot de passe</label>
        <div class="input-container">
          <i class="fas fa-lock input-icon"></i>
          <input
            [type]="confirmPasswordVisible ? 'text' : 'password'"
            id="confirmPassword"
            formControlName="confirmPassword"
            placeholder="••••••••"
            [ngClass]="{ 'is-invalid': (confirmPassword?.invalid || resetForm.errors?.['mismatch']) && (confirmPassword?.dirty || confirmPassword?.touched) }">
          <i
            class="fas password-toggle-icon"
            [ngClass]="confirmPasswordVisible ? 'fa-eye-slash' : 'fa-eye'"
            (click)="togglePasswordVisibility('confirm')"></i>
        </div>
        <div *ngIf="(confirmPassword?.invalid || resetForm.errors?.['mismatch']) && (confirmPassword?.dirty || confirmPassword?.touched)" class="error-message">
          <small *ngIf="confirmPassword?.errors?.['required']">La confirmation est requise</small>
          <small *ngIf="resetForm.errors?.['mismatch']">Les mots de passe ne correspondent pas</small>
        </div>
      </div>

      <div *ngIf="errorMessage" class="alert alert-danger">
        {{ errorMessage }}
      </div>

      <button type="submit" class="btn btn-primary" [disabled]="isLoading || resetForm.invalid">
            <span *ngIf="!isLoading">
              <i class="fas fa-sync-alt me-2"></i> Réinitialiser
            </span>
        <span *ngIf="isLoading">
              <i class="fas fa-spinner fa-spin me-2"></i> Traitement...
            </span>
      </button>

      <div class="back-to-login">
        <a (click)="backToLogin()"><i class="fas fa-arrow-left me-2"></i>Retour à la connexion</a>
      </div>
      </form>
    </div>

    <!-- Success Message -->
    <div class="success-container" *ngIf="showSuccess">
      <div class="success-icon">
        <i class="fas fa-check-circle"></i>
      </div>
      <h4>Mot de passe réinitialisé avec succès !</h4>
      <p>Vous pouvez maintenant vous connecter avec votre nouveau mot de passe.</p>
      <button (click)="backToLogin()" class="btn btn-success">
        <i class="fas fa-sign-in-alt me-2"></i> Se connecter
      </button>
    </div>
  </div>
</div>
</div>
